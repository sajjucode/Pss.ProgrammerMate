/*!CK:3444408904!*//*1448593603,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["oLqba"]); }

__d('SearchFunnelTypeaheadLogger',['Arbiter','Banzai','DOM','Event','PageEvents','PageTransitions','SubscriptionsHandler','URI','csx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q='search_funnel',r='search_end_to_end',s={focus:'entrant',render:'results_displayed',keydown:'interaction',select:'search'},t,u={init:function(v,w){if(!v||!w)return;this._isColdStart=true;this._sampleRates=w;this._core=v.getCore();this._data=v.getData();this._view=v.getView();this._handler=new n();this.log=this.log.bind(this);this.onKeydown=this.onKeydown.bind(this);this.onSelect=this.onSelect.bind(this);this.onTypeaheadImpression=this.onTypeaheadImpression.bind(this);this._transitionInProgress=true;this.onTypeaheadImpression();},onTypeaheadImpression:function(v){this._initTime=this._getInitTime();this.e2eMarkers=[];if(this._transitionInProgress&&j.scry(document.body,"._4d3w").length===0)this.log('impression',{funnel_path:o.getNextURI().path});this.reset();this._handler.addSubscriptions(this._core.subscribeOnce('focus',this.log),this._view.subscribeOnce('render',this.log),this._view.subscribeOnce('select',this.onSelect));k.listen(this._core.getElement(),'keydown',this.onKeydown);m.registerHandler((function(){this._transitionInProgress=true;}).bind(this));m.registerCompletionCallback(this.onTypeaheadImpression);},onKeydown:function(event){if(!this._sawKeydown){this._sawKeydown=true;this.log('keydown',event);}},onSelect:function(event,v){v.funnel_data={selected_position:v.selected.globalIndex,selected_type:v.selected.type};if(v.selected.isNullState){v.funnel_data.interaction_type='null_state';}else if(v.selected.isSingleState){v.funnel_data.interaction_type='single_state';}else v.funnel_data.interaction_type='typed';this._endToEndPath=o.getMostRecentURI().path;t=null;h.subscribe('BigPipe/init',(function(event,w){if(!w.arbiter)return;var x={arbiter:w.arbiter,event:l.AJAXPIPE_ONLOAD,markers:this.e2eMarkers,init_time:this._initTime,from_path:this._endToEndPath};setTimeout((function(){this.setupE2EPerfLogging(x);}).bind(this),0);}).bind(this));this.log(event,v);},reset:function(){this._handler.release();this._handler.engage();this._sawKeydown=false;this._transitionInProgress=false;},log:function(v,w){if(s[v])v=s[v];this.e2eMarkers.push({event:v,time:String(Date.now()-this._initTime)});if(!this._sampleRates[v])return;w=w||{};w.funnel_data=w.funnel_data||{};w.funnel_data.sample_rate=this._sampleRates[v];w.funnel_data.current_event_time=Date.now();if(this._prevTime&&this._prevEvt){w.funnel_data.previous_event_time=this._prevTime;w.funnel_data.previous_event=this._prevEvt;}this._prevTime=w.funnel_data.current_event_time;this._prevEvt=v;i.post(q,{funnel_data:w.funnel_data,path:w.funnel_path||m.getMostRecentURI().path,stage:v},i.VITAL);},setupE2EPerfLogging:function(v){return v.arbiter.subscribeOnce(v.event,(function(w){if(t)return;t=true;v.markers.push({event:'end',time:String(Date.now()-v.init_time)});i.post(r,{from_path:this._endToEndPath,to_path:o.getNextURI().path,markers:v.markers,cold_start:this._isColdStart},i.VITAL);this._isColdStart=false;}).bind(this));},_getInitTime:function(){if(window.ExitTime)return window.ExitTime;var v=window.performance||window.msPerformance;if(!v||!v.timing)return;return v.timing.navigationStart;}};f.exports=u;},null);