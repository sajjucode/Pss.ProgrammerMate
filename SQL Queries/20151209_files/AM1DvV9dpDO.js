/*!CK:2519464371!*//*1449045915,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["agQEH"]); }

__d('ReactComposerPhotoTagger.react',['ReactComposerContextMixin','ReactComposerPhotoActions','ReactComposerPhotoFaceboxTaggerContainer.react','ReactComposerPhotoEditActionButton.react','ReactComposerPhotoStore','ReactComposerPhotoTagActionButton.react','ReactComposerPhotoTaggedFaceboxSummary.react','ActorURI','AsyncRequest','ContextualLayerAutoFlip','Image.react','ImageBlock.react','immutable','ReactLayeredComponentMixin','LayerHideOnBlur','LayerHideOnEscape','LayerTabIsolation','ModalPhotoEditorTabName','ReactComponentWithPureRenderMixin','React','ReactDOM','XStickerPhotoEditorController','PhotoEditorTargetType','XUIContextualDialog.react','XUIContextualDialogBody.react','XUIDialogCloseButton.react','XUIContextualDialogFooter.react','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja){'use strict';if(c.__markCompiled)c.__markCompiled();var ka=aa.PropTypes,la=268,ma=32,na=aa.createClass({displayName:'ReactComposerPhotoTagger',_photoEditorRequest:undefined,mixins:[u,z,h],propTypes:{canTagFromModal:ka.bool,draggingPhotos:ka.bool,enableFaceboxTagger:ka.bool.isRequired,disablePhotoEditing:ka.bool.isRequired,faceboxes:ka.instanceOf(t.Map).isRequired,onEditClick:ka.func,onTagAdded:ka.func.isRequired,onTagIntent:ka.func,onTagRemoved:ka.func.isRequired,originalID:ka.string,photoID:ka.string.isRequired,shown:ka.bool.isRequired},getDefaultProps:function(){return {shown:false};},componentWillReceiveProps:function(oa){if(!this.props.draggingPhotos&&oa.draggingPhotos)i.setPhotoBeingTagged(this.context.composerID,null);},render:function(){var oa=this.props.canTagFromModal?this._onTagClick:null,pa=this.props.enableFaceboxTagger?aa.createElement(m,{hasTag:l.hasTagsInPhoto(this.context.composerID,this.props.photoID),onClick:oa}):null,qa=this.props.disablePhotoEditing?null:aa.createElement(k,{onClick:this._onEditClick});return (aa.createElement('div',{className:"_jfi",onClick:this._onClick,tabIndex:'-1'},pa,qa));},renderLayers:function(){if(!this.props.shown||!this.props.enableFaceboxTagger)return null;return {dialog:this._getDialog()};},_getDialog:function(){return (aa.createElement(ea,{ref:'dialog',shown:this.props.shown,onToggle:this._onDialogToggled,context:ba.findDOMNode(this),position:'below',alignment:'center',width:la,behaviors:{LayerHideOnBlur:v,LayerHideOnEscape:w,ContextualLayerAutoFlip:q,LayerTabIsolation:x}},aa.createElement(fa,null,this._getDialogBody()),aa.createElement(ha,null,aa.createElement(ga,{use:'confirm',label:'Close',onClick:this._onCloseButtonClicked}))));},_getDialogBody:function(){if(this.props.faceboxes.size===0)return ja._("We could not find any faces to tag.");return this.props.faceboxes.valueSeq().map((function(oa){var pa=oa.taggedSubjectID?aa.createElement(n,{faceboxID:oa.id,onTagRemoved:this.props.onTagRemoved,taggedSubjectID:oa.taggedSubjectID,taggedValue:oa.taggedValue}):aa.createElement(j,{faceboxID:oa.id,onTagAdded:this.props.onTagAdded});return (aa.createElement(s,{key:oa.id,className:"_qv7"},aa.createElement(r,{className:"_qv8",height:ma,src:oa.croppedURI,width:ma}),pa));}).bind(this));},_onCloseButtonClicked:function(){i.setPhotoBeingTagged(this.context.composerID,null);},_onDialogToggled:function(oa){if(!oa)this._onCloseButtonClicked();},_onClick:function(){this.props.onTagIntent&&this.props.onTagIntent();i.setPhotoBeingTagged(this.context.composerID,this.props.photoID);},_onTagClick:function(event){this._onEditClick(event,null,y.TAG);},_onEditClick:function(event,oa,pa){event.stopPropagation();if(this._photoEditorRequest)return;var qa=ca.getURIBuilder().setString('grid_id',this.context.composerID).setEnum('target_type',da.COMPOSER).setInt('latest_fbid',this.props.photoID).setInt('photo_fbid',this.props.originalID||this.props.photoID).setEnum('initial_tab',pa).getURI();qa=o.create(qa,this.context.actorID);this._photoEditorRequest=new p(qa).setFinallyHandler((function(){this._photoEditorRequest=null;}).bind(this));this._photoEditorRequest&&this._photoEditorRequest.send();this.props.onEditClick&&this.props.onEditClick();i.startPhotoEdit(this.context.composerID);}});f.exports=na;},null);