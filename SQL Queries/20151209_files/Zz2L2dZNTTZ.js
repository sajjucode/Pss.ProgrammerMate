/*!CK:431782777!*//*1449215223,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["JClYN"]); }

__d('ReactComposerPhotoUploadsGridContainer.react',['ReactComposerContextMixin','ReactComposerPhotoUploadActions','ReactComposerPhotoUploadsGrid.react','Locale','ReactComponentWithPureRenderMixin','React','ReactDOM','Rect','Vector'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q=m.PropTypes,r=m.createClass({displayName:'ReactComposerPhotoUploadsGridContainer',_componentsPosition:{},mixins:[l,h],propTypes:{photoUploadLink:q.element,enableFaceboxTagger:q.bool,disablePhotoEditing:q.bool,showSellUploadLink:q.bool},getInitialState:function(){return {rtl:k.isRTL(),sourceIndex:null,targetIndex:null,uploads:this.props.uploads};},componentWillReceiveProps:function(s){if(this.state.uploads!==s.uploads)this.setState({uploads:s.uploads});},render:function(){return (m.createElement(j,babelHelpers._extends({},this.props,{onGrab:this._onGrab,onDrag:this._onDrag,onDrop:this._onDrop,sourceIndex:this.state.sourceIndex,targetIndex:this.state.targetIndex,updateComponentPosition:this._updateComponentPosition,uploads:this.state.uploads})));},_onGrab:function(s,t){var u=this.state.uploads.findIndex(function(v){return v.id===s;});this.setState({sourceIndex:u,targetIndex:u});},_onDrag:function(s){var t=p.getElementPosition(n.findDOMNode(this));s=s.sub(t);this.setState({targetIndex:this._getTargetID(s)});},_onDrop:function(s){this._onDrag(s);var t=this.state.sourceIndex,u=this.state.targetIndex;if(t==null||u==null)return;if(t!==u){var v=this.state.uploads;v=v.splice(t,1).splice(u,0,v.get(t));this.setState({uploads:v});i.photoMoved(this.context.composerID,t,u);}this._endDrag();},_endDrag:function(){this.setState({sourceIndex:null,targetIndex:null});},_getTargetID:function(s){var t=this.state.uploads,u=this.state.rtl?function(z,aa){return z.right>=aa.x;}:function(z,aa){return z.left<=aa.x;};for(var v=t.size-1;v>=0;v--){var w=t.get(v),x=w.id,y=this._componentsPosition[x];if(u(y,s))return v;}return 0;},_updateComponentPosition:function(s,t,u){var v=new o(n.findDOMNode(this));this._componentsPosition[s]={left:t.x-v.l,right:t.x-v.l+u.x};}});f.exports=r;},null);