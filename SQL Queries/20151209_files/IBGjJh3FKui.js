/*!CK:1967263175!*//*1448830161,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["byxln"]); }

__d('PubcontentFeedChainingControllerX',['AggregatedLinkComposerConfig','Arbiter','AsyncRequest','AttachmentRelatedShareConstants','ContextualThing','CreateTopicConversationChainingConfig','CSS','csx','cx','DOM','DOMQuery','FeedAdsChainingConfig','NavigationMessage','PageLikeConstants','PubcontentFeedChainingConfig','PubcontentRelatedShareChainingConfig','PubcontentTopicChainingConfig','StoryInlinePivotChainingConfig','RelatedEventsPivotChainingConfig','Run','SearchRelatedPostsPivotChainingConfig','StoryTopicMap','SubscriptionsHandler','UFIFeedbackTargets','UFIUIEvents','XEventRelatedEventsPivotController','XSearchRelatedPostsPivotController','XFeedAdsChainingController','XPubcontentFeedChainingController','XPubcontentRelatedShareChainingController','XPubcontentRelatedVideoChainingController','XPubcontentTopicChainingController','XPubcontentInlineStoryPivotChainingController','XRelatedGamesChainingController','XTopicConversationFeedPivotChainingController'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa){if(c.__markCompiled)c.__markCompiled();var qa='ei',ra='ad_fan_page_action',sa='ad_like_page_post_action',ta='page_story_like_action',ua='related_share_article_click',va='related_share_video_click',wa='page_share_like_action',xa='topic_story_like_action',ya='story_click_for_pivot_action',za='story_like_pivot_action',ab='event_join',bb='comment_on_topic_conversation_target_action',cb='composer_publish_action',db=null,eb=false;fb.init=function(gb){'use strict';var hb=gb.isLazy;if(!db)db=new fb({isLazy:hb});if(!eb){aa.onLeave(fb.cleanup);i.subscribe(t.NAVIGATION_BEGIN,fb.cleanup);eb=true;}};fb.cleanup=function(){'use strict';if(db){db.cleanup();db=null;}};function fb(gb){'use strict';var hb=gb.isLazy;this.$PubcontentFeedChainingControllerX1=v;this.$PubcontentFeedChainingControllerX2=s;this.$PubcontentFeedChainingControllerX3=w;this.$PubcontentFeedChainingControllerX4=x;this.$PubcontentFeedChainingControllerX5=y;this.$PubcontentFeedChainingControllerX6=z;this.$PubcontentFeedChainingControllerX7=ba;this.$PubcontentFeedChainingControllerX8=m;this.$PubcontentFeedChainingControllerX9={};this.$PubcontentFeedChainingControllerX10=new da();this.$PubcontentFeedChainingControllerX10.addSubscriptions(this.$PubcontentFeedChainingControllerX11(u.LIKED,hb,this.$PubcontentFeedChainingControllerX12.bind(this)),this.$PubcontentFeedChainingControllerX11(fa.ActionLinkLike,hb,this.$PubcontentFeedChainingControllerX13.bind(this)),this.$PubcontentFeedChainingControllerX11(fa.ReactionButtonClicked,hb,this.$PubcontentFeedChainingControllerX13.bind(this)),this.$PubcontentFeedChainingControllerX11(fa.ActionAddComment,hb,this.$PubcontentFeedChainingControllerX14.bind(this)),this.$PubcontentFeedChainingControllerX11('composer/publish',hb,this.$PubcontentFeedChainingControllerX15.bind(this)),this.$PubcontentFeedChainingControllerX11('LitestandComposer/publish',hb,this.$PubcontentFeedChainingControllerX15.bind(this)),this.$PubcontentFeedChainingControllerX11(k.ARTICLE_CLICK,hb,this.$PubcontentFeedChainingControllerX16.bind(this)),this.$PubcontentFeedChainingControllerX11(k.VIDEO_CLICK,hb,this.$PubcontentFeedChainingControllerX17.bind(this)),this.$PubcontentFeedChainingControllerX11(k.FBVIDEO_CLICK,hb,this.$PubcontentFeedChainingControllerX18.bind(this)),this.$PubcontentFeedChainingControllerX11(k.GAME_CLICK,hb,this.$PubcontentFeedChainingControllerX19.bind(this)),this.$PubcontentFeedChainingControllerX11(k.PHOTO_CLICK,hb,this.$PubcontentFeedChainingControllerX20.bind(this)),this.$PubcontentFeedChainingControllerX11(k.EVENT_JOIN,hb,this.$PubcontentFeedChainingControllerX21.bind(this)));}fb.prototype.$PubcontentFeedChainingControllerX11=function(event,gb,hb){'use strict';var ib=gb?[event,event+'.lazy']:[event];return i.subscribe(ib,hb);};fb.prototype.cleanup=function(){'use strict';this.$PubcontentFeedChainingControllerX10&&this.$PubcontentFeedChainingControllerX10.release();this.$PubcontentFeedChainingControllerX10=null;};fb.getAdClientTokenIndex=function(){'use strict';return qa;};fb.prototype.$PubcontentFeedChainingControllerX12=function(gb,hb){'use strict';var ib=this.findAdClientToken(hb.target);if(ib){this.$PubcontentFeedChainingControllerX22(hb.target,{origin:ra,actor_id:hb.profile_id,client_token:ib});}else this.$PubcontentFeedChainingControllerX23(hb.target,{origin:hb.origin,actor_id:hb.profile_id});};fb.prototype.$PubcontentFeedChainingControllerX14=function(gb,hb){'use strict';if(!hb.feedback)return null;var ib=this.$PubcontentFeedChainingControllerX24(hb.target,{origin:bb,data:hb});if(!ib)return false;var jb=pa.getURIBuilder().getURI();new j(jb).setErrorHandler(this.$PubcontentFeedChainingControllerX25.bind(this,ib.story.id)).setRelativeTo(ib.chainingWrapper).setMethod('POST').setData({story_id:hb.feedback.entidentifier}).send();return true;};fb.prototype.$PubcontentFeedChainingControllerX13=function(gb,hb){'use strict';if(!hb.ft_id||!hb.target)return;if(!this.$PubcontentFeedChainingControllerX26(this.findStory(hb.target))||this.$PubcontentFeedChainingControllerX27(this.findStory(hb.target)))return;ea.getFeedbackTarget(hb.ft_id,(function(ib,jb){var kb=this.findAdClientToken(ib);if(kb&&jb.isshare){this.$PubcontentFeedChainingControllerX22(ib,{actor_id:jb.actorid,origin:sa,ft_id:jb.entidentifier,client_token:kb});}else if(jb.isownerpage){this.$PubcontentFeedChainingControllerX23(ib,{actor_id:jb.actorid,content_id:jb.entidentifier,origin:ta});}else if(jb.isshare){this.$PubcontentFeedChainingControllerX23(ib,{actor_id:jb.actorid,content_id:jb.entidentifier,ft_id:jb.entidentifier,origin:wa});}else{var lb=ca.getTopicsForFTID(jb.entidentifier);if(lb&&lb.length>0){this.$PubcontentFeedChainingControllerX28(ib,{ft_id:jb.entidentifier,origin:xa,pivotal_topic_ids:lb});}else this.$PubcontentFeedChainingControllerX29(ib,{origin:za,ft_id:jb.entidentifier});}}).bind(this,hb.target));};fb.prototype.$PubcontentFeedChainingControllerX29=function(gb,hb){'use strict';var ib=this.$PubcontentFeedChainingControllerX24(gb,hb);if(!ib)return false;var jb=na.getURIBuilder().setString('origin',hb.origin);if(hb.story_id)jb.setString('storyid',String(hb.story_id));if(hb.ft_id)jb.setString('ftid',String(hb.ft_id));new j().setErrorHandler(this.$PubcontentFeedChainingControllerX25.bind(this,ib.story.id)).setRelativeTo(ib.chainingWrapper).setURI(jb.getURI()).setAllowCrossPageTransition(true).send();return true;};fb.prototype.$PubcontentFeedChainingControllerX20=function(gb,hb){'use strict';var ib=this;ib.$PubcontentFeedChainingControllerX29(hb.attachment,{origin:ya,story_id:hb.storyid});};fb.prototype.$PubcontentFeedChainingControllerX16=function(gb,hb){'use strict';if(h.no_chained_related_stories==='true')return;hb.origin=ua;var ib=this,jb=this.findStory(hb.attachment),kb=r.scry(r.getRootElement(),'#initial_browse_result').length>0;if(kb)return;var lb;if(hb.is_right_click){lb=0;}else lb=k.EVENT_DELAY;setTimeout(function(){if(jb){var mb=ib.findAttachment(jb);if(mb)hb.attachment=mb;}ib.$PubcontentFeedChainingControllerX30(hb.attachment,hb);},lb);};fb.prototype.$PubcontentFeedChainingControllerX17=function(gb,hb){'use strict';hb.origin=va;var ib=this,jb=this.findStory(hb.attachment);setTimeout(function(){if(jb){var kb=ib.findAttachment(jb);if(kb)hb.attachment=kb;}ib.$PubcontentFeedChainingControllerX30(hb.attachment,hb);},k.EVENT_DELAY);};fb.prototype.$PubcontentFeedChainingControllerX18=function(gb,hb){'use strict';hb.origin=va;var ib=this,jb=this.findStory(hb.attachment);setTimeout(function(){if(jb){var kb=ib.findAttachment(jb);if(kb)hb.attachment=kb;}ib.$PubcontentFeedChainingControllerX30(hb.attachment,hb);},k.EVENT_DELAY);};fb.prototype.$PubcontentFeedChainingControllerX19=function(gb,hb){'use strict';var ib=this,jb=this.findStory(hb.attachment);setTimeout(function(){if(jb)var kb=ib.findContainer(jb);ib.$PubcontentFeedChainingControllerX31(jb,hb.global_share_id,q.getID(kb));},k.EVENT_DELAY);};fb.prototype.$PubcontentFeedChainingControllerX21=function(gb,hb){'use strict';var ib=this.findStory(hb.attachment);if(ib){var jb=this.findAttachment(ib);if(jb)hb.attachment=jb;}this.$PubcontentFeedChainingControllerX32(hb.attachment,{origin:ab,event_id:hb.event_id});};fb.prototype.$PubcontentFeedChainingControllerX15=function(gb,hb){'use strict';var ib=this;setTimeout(function(){ib.$PubcontentFeedChainingControllerX33(hb.markup.firstChild,{origin:cb,content_id:hb.content_id});},this.$PubcontentFeedChainingControllerX7.composer_publish_action);};fb.prototype.$PubcontentFeedChainingControllerX34=function(gb){'use strict';return !!(gb&&gb.id&&!n.hasClass(gb,"_sf6")&&!(gb.id in this.$PubcontentFeedChainingControllerX9));};fb.prototype.$PubcontentFeedChainingControllerX35=function(gb){'use strict';if(!gb)return false;if(gb.origin in this.$PubcontentFeedChainingControllerX1||gb.origin in this.$PubcontentFeedChainingControllerX3||gb.origin in this.$PubcontentFeedChainingControllerX2||gb.origin in this.$PubcontentFeedChainingControllerX5||gb.origin in this.$PubcontentFeedChainingControllerX6||gb.origin in this.$PubcontentFeedChainingControllerX8||gb.origin in this.$PubcontentFeedChainingControllerX7){return true;}else{var hb=this.$PubcontentFeedChainingControllerX4[gb.origin];if(!hb||!hb.rate)return false;var ib=Math.random();if(ib>hb.rate)return false;return true;}};fb.prototype.$PubcontentFeedChainingControllerX36=function(gb){'use strict';this.$PubcontentFeedChainingControllerX9[gb]=true;};fb.prototype.$PubcontentFeedChainingControllerX25=function(gb){'use strict';delete this.$PubcontentFeedChainingControllerX9[gb];};fb.prototype.$PubcontentFeedChainingControllerX26=function(gb){'use strict';if(!gb)return false;var hb="_3lkn",ib=gb.nextSibling,jb=true;if(ib&&ib.firstChild){var kb=ib.firstChild;jb=!(kb.hasChildNodes()&&n.hasClass(kb,hb));}if(!jb)return false;var lb=gb.children[0],mb=gb.children[1],nb="_4_ck";if(lb&&n.hasClass(lb,nb)||mb&&n.hasClass(mb,nb))return false;return true;};fb.prototype.$PubcontentFeedChainingControllerX27=function(gb){'use strict';if(!gb)return true;var hb=q.scry(gb,"._1xwr");if(hb.length)return true;return false;};fb.prototype.$PubcontentFeedChainingControllerX24=function(gb,hb){'use strict';var ib=this.findStory(gb);if(!this.$PubcontentFeedChainingControllerX34(ib))return null;if(!this.$PubcontentFeedChainingControllerX35(hb))return null;this.$PubcontentFeedChainingControllerX36(ib.id);if(this.isSponsoredStory(ib))return null;var jb;if(!hb.continued_chaining){jb=this.findContainer(ib);if(!jb)return null;var kb=q.create('div'),lb=q.appendContent(jb,kb);if(lb.length!==1)return null;}else{jb=ib;kb=q.create('div');lb=q.insertAfter(jb,kb);q.remove(jb);if(lb.length!==1)return null;}if(hb.is_auto_expand){return {chainingWrapper:lb[0],story:ib,is_auto_expand:hb.is_auto_expand};}else return {chainingWrapper:lb[0],story:ib};};fb.prototype.$PubcontentFeedChainingControllerX22=function(gb,hb){'use strict';var ib=this.$PubcontentFeedChainingControllerX24(gb,hb);if(!ib)return false;var jb=this.findStreamRoot(ib.story);if(!jb)return false;var kb=jb.getAttribute('id'),lb=ia.getURIBuilder().setString('actor_id',hb.actor_id).setString('origin',hb.origin).setString('ei',hb.client_token).setString('data_ownerid',kb);if(hb.ft_id)lb.setString('ft_id',hb.ft_id);new j().setErrorHandler(this.$PubcontentFeedChainingControllerX25.bind(this,ib.story.id)).setRelativeTo(ib.chainingWrapper).setURI(lb.getURI()).send();return true;};fb.prototype.$PubcontentFeedChainingControllerX30=function(gb,hb){'use strict';if(!this.$PubcontentFeedChainingControllerX26(this.findStory(gb)))return false;var ib=this.$PubcontentFeedChainingControllerX24(gb,hb);if(!ib)return false;n.addClass(ib.chainingWrapper,"_3lkn");var jb=null;if(hb.fbvideo_id){jb=la.getURIBuilder();jb.setInt('fbvideo_id',hb.fbvideo_id);}else{jb=ka.getURIBuilder();jb.setInt('global_share_id',hb.global_share_id);}jb.setString('attachment_div_id',q.getID(hb.attachment));if(hb.link_url)jb.setString('link_url',hb.link_url);if(hb.video_div_id)jb.setString('video_div_id',hb.video_div_id);if(hb.share_id)jb.setString('share_id',hb.share_id);var kb=JSON.parse(ib.story.getAttribute('data-ft'))||{};if('qid' in kb&&'mf_story_key' in kb){jb.setString('qid',kb.qid);jb.setString('mf_story_key',kb.mf_story_key);}if(hb.is_auto_expand){this.$PubcontentFeedChainingControllerX25(ib.story.id);jb.setBool('is_auto_expand',hb.is_auto_expand);}var lb=new j().setErrorHandler(this.$PubcontentFeedChainingControllerX25.bind(this,ib.story.id)).setRelativeTo(ib.chainingWrapper).setURI(jb.getURI());kb&&lb.setData(kb);lb.send();return true;};fb.prototype.$PubcontentFeedChainingControllerX31=function(gb,hb,ib){'use strict';if(!this.$PubcontentFeedChainingControllerX34(gb))return null;this.$PubcontentFeedChainingControllerX36(gb.id);var jb=oa.getURIBuilder().setInt('app_id',hb).setString('attachment_div_id',ib);new j().setErrorHandler(this.$PubcontentFeedChainingControllerX25.bind(this,gb.id)).setURI(jb.getURI()).send();return true;};fb.prototype.$PubcontentFeedChainingControllerX23=function(gb,hb){'use strict';var ib=this.$PubcontentFeedChainingControllerX24(gb,hb);if(!ib)return false;var jb=ja.getURIBuilder().setString('actor_id',hb.actor_id).setString('origin',hb.origin);if(hb.ft_id)jb.setString('ft_id',hb.ft_id);if(hb.content_id)jb.setString('content_id',hb.content_id);new j().setErrorHandler(this.$PubcontentFeedChainingControllerX25.bind(this,ib.story.id)).setRelativeTo(ib.chainingWrapper).setURI(jb.getURI()).send();return true;};fb.prototype.$PubcontentFeedChainingControllerX28=function(gb,hb){'use strict';var ib=this.$PubcontentFeedChainingControllerX24(gb,hb);if(!ib)return false;var jb=ma.getURIBuilder().setIntVector('pivotal_topic_ids',hb.pivotal_topic_ids).getURI();new j().setErrorHandler(this.$PubcontentFeedChainingControllerX25.bind(this,ib.story.id)).setRelativeTo(ib.chainingWrapper).setURI(jb).send();return true;};fb.prototype.$PubcontentFeedChainingControllerX32=function(gb,hb){'use strict';var ib=this.$PubcontentFeedChainingControllerX24(gb,hb);if(!ib)return false;var jb=ga.getURIBuilder().setInt('event_id',hb.event_id).setString('attachment_id',q.getID(gb)).getURI();new j().setErrorHandler(this.$PubcontentFeedChainingControllerX25.bind(this,ib.story.id)).setRelativeTo(ib.chainingWrapper).setURI(jb).send();return true;};fb.prototype.$PubcontentFeedChainingControllerX33=function(gb,hb){'use strict';var ib=this.$PubcontentFeedChainingControllerX24(gb,hb);if(!ib)return false;var jb=ha.getURIBuilder().setString('origin',hb.origin).setString('content_id',String(hb.content_id));new j().setErrorHandler(this.$PubcontentFeedChainingControllerX25.bind(this,ib.story.id)).setRelativeTo(ib.chainingWrapper).setURI(jb.getURI()).setAllowCrossPageTransition(true).send();return true;};fb.prototype.findStory=function(gb){'use strict';var hb="^div._4-u2",ib=q.scry(gb,hb);return ib.length===1?ib[0]:null;};fb.prototype.isSponsoredStory=function(gb){'use strict';var hb="._5paw";return q.scry(gb,hb).length>0;};fb.prototype.findAttachment=function(gb){'use strict';var hb="div._6m2",ib="div.iframeEmbed",jb=q.scry(gb,hb)[0]||q.scry(gb,ib)[0];return jb;};fb.prototype.findContainer=function(gb){'use strict';var hb=q.create('div'),ib=q.insertAfter(gb,hb);l.register(hb,gb);return ib.length>=1?ib[0]:null;};fb.prototype.findStreamRoot=function(gb){'use strict';var hb="^div._4ikz";return q.scry(gb,hb)[0];};fb.prototype.findAdClientToken=function(gb){'use strict';var hb=this.findStory(gb);if(!hb)return null;var ib=hb.getAttribute('data-ft');if(!ib)return null;var jb=JSON.parse(ib);return jb[fb.getAdClientTokenIndex()];};f.exports=fb;},null);