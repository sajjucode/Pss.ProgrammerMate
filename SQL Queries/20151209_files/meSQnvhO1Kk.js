/*!CK:1801680583!*//*1447048125,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["9EPQs"]); }

__d('isSoftNewlineEvent',['Keys'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(j){return j.which===h.RETURN&&(j.getModifierState('Shift')||j.getModifierState('Alt')||j.getModifierState('Control'));}f.exports=i;},null);
__d('applyEmoticonToContentBlock',['CharacterMetadata','DraftEntity','EmoticonsList','immutable'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=k.List,m='\u3000';function n(o,p,q){if(!j.emotes[p])return o;var r=i.create('EMOTICON','IMMUTABLE',{type:j.emotes[p],originalEmoticon:p}),s=o.getText(),t=o.getCharacterList(),u=p.length,v=t.get(q);return o.merge({text:s.slice(0,q)+m+s.slice(q+u),characterList:t.slice(0,q).concat(l.of(h.applyEntity(v,r)),t.slice(q+u))});}f.exports=n;},null);
__d('getTextAfterNearestEntity',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i,j){var k=j;while(k>0&&i.getEntityAt(k-1)===null)k--;return i.getText().slice(k,j);}f.exports=h;},null);
__d('applyEmoticonToContentState',['EmoticonsList','applyEmoticonToContentBlock','getTextAfterNearestEntity'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=new RegExp(h.regexp.source,'g');function l(m,n){var o=n.getAnchorKey(),p=n.getAnchorOffset(),q=m.getBlockForKey(o),r=j(q,p),s,t;while(t!==null){t=k.exec(r);if(t!==null)s=t;}if(!s)return m;var u=s[1];if(!u&&p!==r.length)return m;var v=s[2],w=p-r.length,x=w+s.index+s[1].length,y=m.getBlockMap().set(o,i(q,v,x));p-=v.length-1;return m.merge({blockMap:y,selectionBefore:n,selectionAfter:n.merge({anchorOffset:p,focusOffset:p})});}f.exports=l;},null);
__d('handleBeforeInputForEmoticon',['DraftModifier','EditorState','applyEmoticonToContentState'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=new RegExp(/[\s'".,!?]/);function l(m,n){var o=m.getSelection();if(!o.isCollapsed()||!n||!k.test(n))return m;var p=m.getCurrentContent(),q=j(p,o);if(q===p)return m;var r=h.insertText(q,q.getSelectionAfter(),n);return i.push(m,r,'insert-characters');}f.exports=l;},null);
__d('handleSoftNewlineForEmoticon',['DraftModifier','EditorState','applyEmoticonToContentState'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(l){var m=l.getCurrentContent(),n=l.getSelection(),o=j(m,n);if(o===m)return l;var p=h.splitBlock(o,o.getSelectionAfter());return i.push(l,p,'split-block');}f.exports=k;},null);
__d('insertEmoticonIntoContentState',['DraftModifier','applyEmoticonToContentBlock'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();function j(k,l,m){var n=h.replaceText(l,m,k),o=m.getAnchorKey(),p=m.getAnchorOffset(),q=n.getBlockForKey(o),r=n.getBlockMap().set(o,i(q,k,p));p++;return l.merge({blockMap:r,selectionBefore:m,selectionAfter:m.merge({anchorOffset:p,focusOffset:p})});}f.exports=j;},null);
__d('insertEmoticonIntoEditorState',['DraftModifier','EditorState','insertEmoticonIntoContentState'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=' ';function l(m,n){var o=n.getSelection(),p=n.getCurrentContent(),q=o.getStartOffset(),r=o.getEndOffset(),s=p.getBlockForKey(o.getStartKey()).getText(),t=p.getBlockForKey(o.getEndKey()).getText(),u='';if(r<=t.length&&t[r]!==k)u=k;if(q>0&&s[q-1]!==k){p=h.insertText(p,o,k);o=p.getSelectionAfter();}var v=j(m,p,o);p=h.insertText(v,v.getSelectionAfter(),u);return i.push(n,p,'insert-characters');}f.exports=l;},null);
__d('ChatInput.react',['AbstractTextEditor.react','Bootloader','ChatConfig','ContentState','CompositeDraftDecorator','DraftDecorator','DraftModifier','EditorState','EmoticonSpan.react','React','ReactDOM','createPlainBlocksFromText','emptyFunction','getDefaultKeyBinding','getEntityMatcher','getVisibleValueForContentState','handleBeforeInputForEmoticon','handleSoftNewlineForEmoticon','insertEmoticonIntoEditorState','isSoftNewlineEvent','setImmediate'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){'use strict';if(c.__markCompiled)c.__markCompiled();var ca=q.PropTypes,da=t.thatReturnsNull,ea=q.createClass({displayName:'ChatInput',propTypes:{blockStyleFn:ca.func,initializeThingsWithInputFn:ca.func,inlineStyleFn:ca.func,inputKeyDown:ca.func,keyBindingFn:ca.func,onBlur:ca.func,onEscape:ca.func,onFocus:ca.func,onTab:ca.func,resizeFn:ca.func},getDefaultProps:function(){return {blockStyleFn:da,inlineStyleFn:da,keyBindingFn:u};},componentDidMount:function(){this._oldHeight=r.findDOMNode(this).getBoundingClientRect().height;this.props.resizeFn(this._oldHeight);this.props.initializeThingsWithInputFn(r.findDOMNode(this.refs.input),this.getValue);this.setState({triggeredWord:this.props.triggeredWord});},componentWillReceiveProps:function(fa){if(this.state.triggeredWord!==fa.triggeredWord)this.setState({triggeredWord:fa.triggeredWord},this._updateDecorator);},componentDidUpdate:function(){ba((function(){var fa=r.findDOMNode(this).getBoundingClientRect().height;if(this._oldHeight!==fa)this.props.resizeFn(fa);this._oldHeight=fa;}).bind(this));},getInitialState:function(){return {editorState:this._createEmptyEditorState()};},_createEmptyEditorState:function(){var fa=s(['']);return o.createWithContent(k.createFromBlockArray(fa),this._getDecorator());},resetState:function(){if(this.state.typeaheadReporter){this.state.typeaheadReporter.sessionEnd();this.state.typeaheadReporter.sessionStart();}this.setState({editorState:o.moveFocusToEnd(this._createEmptyEditorState()),triggeredWord:null});},_updateDecorator:function(){var fa=this._getDecorator();ba((function(){var ga=o.set(this.state.editorState,{decorator:fa});this.setState({editorState:ga});}).bind(this));},_getDecorator:function(){return new l([new m(v(function(fa){return fa.getType()==='EMOTICON';}),p)]);},onChange:function(fa){this.setState({editorState:fa});},onReturn:function(event){if(aa(event)){var fa=y(this.state.editorState);if(fa===this.state.editorState)return false;this.setState({editorState:fa});return true;}this.props.inputKeyDown(event,this.getValue());this.resetState();return true;},getValueFromEditorState:function(fa){var ga=fa.getCurrentContent();return w(ga);},getValue:function(){return this.getValueFromEditorState(this.state.editorState);},focus:function(){this.refs.input.focus();},_handleBeforeInput:function(fa){var ga=x(this.state.editorState,fa);if(ga===this.state.editorState)return false;this.setState({editorState:ga});return true;},_handleFiles:function(fa){var ga=/^image\//,ha=fa.filter(function(ia){return ga.test(ia.type);});if(ha.length){this.props.uploadPhotoFn(ha[0]);return true;}return false;},_handlePastedFiles:function(fa){return this._handleFiles(fa);},_handleDroppedFiles:function(fa,ga){return this._handleFiles(ga);},insertEmoticon:function(fa){var ga=z(fa,this.state.editorState);if(ga!==this.state.editorState)this.setState({editorState:ga});},appendText:function(fa){var ga=this.state.editorState,ha=ga.getSelection(),ia=ga.getCurrentContent();ia=n.insertText(ia,ha,fa);ga=o.push(ga,ia,'insert-characters');this.setState({editorState:ga});},render:function(){return (q.createElement(h,babelHelpers._extends({ref:'input'},this.props,{editorState:this.state.editorState,onChange:this.onChange,handleBeforeInput:this._handleBeforeInput,handlePastedFiles:this._handlePastedFiles,handleDroppedFiles:this._handleDroppedFiles,handleReturn:this.onReturn,spellCheck:true})));}});f.exports=ea;},null);