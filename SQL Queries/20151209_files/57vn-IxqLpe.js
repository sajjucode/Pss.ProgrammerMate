/*!CK:2030155488!*//*1449215223,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["\/Y8In"]); }

__d('ReactComposerDraggablePhoto.react',['ReactComposerContextMixin','ReactComposerFailedPhotoUploadContainer.react','ReactComposerPhotoActions','ReactComposerPhotoContainer.react','ReactComposerPhotoUploadPlaceholderContainer.react','ReactComposerPhotoUploadState','Draggable','ReactComponentWithPureRenderMixin','React','ReactDOM','Vector','cx','throttle'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){'use strict';if(c.__markCompiled)c.__markCompiled();var u=p.PropTypes,v=200,w=5,x=m.PHOTO_UPLOAD_DONE,y=p.createClass({displayName:'ReactComposerDraggablePhoto',_draggable:undefined,_grabbed:undefined,mixins:[o,h],propTypes:{enableFaceboxTagger:u.bool,disablePhotoEditing:u.bool,mediaConfig:u.object.isRequired,nuxConfig:u.object.isRequired,upload:u.object.isRequired,draggingPhotos:u.bool,index:u.number,updateComponentPosition:u.func.isRequired,onGrab:u.func.isRequired,onDrag:u.func.isRequired,onDrop:u.func.isRequired},getInitialState:function(){return {dragging:false};},componentWillReceiveProps:function(z){if(this.props.index!==z.index&&z.index!==undefined)setTimeout(this._updateComponentPosition,0);},componentDidUpdate:function(z){if(z.upload.state!==x&&this.props.upload.state===x){this._createDraggable();}else if(z.upload.state===x&&this.props.upload.state!==x)this._draggable&&this._draggable.destroy();},componentDidMount:function(){if(this.props.upload.state===x)this._createDraggable();setTimeout(this._updateComponentPosition,0);},componentWillUnmount:function(){this._draggable&&this._draggable.destroy();},render:function(){var z=(this.state.dragging?"_3j72":'')+(' '+"_3j73");return (p.createElement('div',{className:z,onClick:this._onClick,key:this.props.upload.photoID||this.props.upload.id},this._getInnerComponent()));},_getInnerComponent:function(){var z=this.props.upload;if(z.state===x){var aa=this,ba={add:function(ca){aa._draggable&&aa._draggable.addHandle(ca);},remove:function(ca){aa._draggable&&aa._draggable.removeHandle(ca);}};return (p.createElement(k,{canTagFromModal:this.props.mediaConfig.canTagFromModal,draggingPhotos:this.props.draggingPhotos,dragHandler:ba,enableFaceboxTagger:this.props.enableFaceboxTagger,disablePhotoEditing:this.props.disablePhotoEditing,key:z.photoID,nuxConfig:this.props.nuxConfig,originalID:z.originalPhotoID,photoID:z.photoID,uploadID:z.id}));}if(z.state===m.PHOTO_UPLOAD_FAILED)return (p.createElement(i,{error:z.error,filename:z.filename,key:z.id,mediaConfig:this.props.mediaConfig,uploadID:z.id}));return (p.createElement(l,{key:z.id,uploadID:z.id}));},_createDraggable:function(){this._draggable=new n(q.findDOMNode(this)).setNamespace('ReactComposer').setUseAbsolute(true).setAvoidKillingEvents(true).setGutter(w).setGrabHandler(this._onGrab).setDragHandler(t(this._onDrag,v)).setDropHandler(this._onDrop);this._updateComponentPosition();},_updateComponentPosition:function(){var z=q.findDOMNode(this);this.props.updateComponentPosition(this.props.upload.id||this.props.upload.photoID,r.getElementPosition(z),r.getElementDimensions(z));},_onGrab:function(){if(this.state.dragging)return;this._grabbed=true;var z=q.findDOMNode(this);this.props.onGrab(this.props.upload.id||this.props.upload.photoID,z);},_onDrag:function(z){if(!this._grabbed)return;this.setState({dragging:true});this.props.onDrag(z);},_onDrop:function(z){this._draggable&&this._draggable.resetPosition();this.setState({dragging:false});this._grabbed=false;this.props.onDrop(z);},_onClick:function(){j.setPhotoBeingTagged(this.context.composerID,this.props.upload.photoID);}});f.exports=y;},null);